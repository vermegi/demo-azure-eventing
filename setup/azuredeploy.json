{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "projectname": {
      "type": "string",
      "metadata": {
          "description": "Name of the project"
      }
    }
  },
  "variables": {
    "serviceBusNamespaceName": "[parameters('projectname')]",
    "logicAppName": "[parameters('projectname')]",
    "databaseAccountName": "[parameters('projectname')]",
    "siteName": "[parameters('projectname')]"
  },
  "resources": [
    {
      "apiVersion": "2015-01-01", 
      "name": "webappTemplate", 
      "type": "Microsoft.Resources/deployments", 
      "properties": { 
        "mode": "incremental", 
        "templateLink": {
          "uri": "https://raw.githubusercontent.com/vermegi/demo-azure-eventing/feature/setup/setup/webappTemplate.json",
          "contentVersion": "1.0.0.0"
        }, 
        "parametersLink": { 
          "uri":"https://raw.githubusercontent.com/vermegi/demo-azure-eventing/feature/setup/setup/webappTemplate.parameters.json",
          "contentVersion":"1.0.0.0"
       },
       "parameters":{
         "siteName": {"value": "[variables('siteName')]"}
       }
      } 
    },
    {
      "apiVersion": "2015-01-01", 
      "name": "serviceBusTemplate", 
      "type": "Microsoft.Resources/deployments", 
      "properties": { 
        "mode": "incremental", 
        "templateLink": {
          "uri": "https://raw.githubusercontent.com/vermegi/demo-azure-eventing/feature/setup/setup/serviceBusTemplate.json",
          "contentVersion": "1.0.0.0"
        }, 
        "parametersLink": { 
          "uri":"https://raw.githubusercontent.com/vermegi/demo-azure-eventing/feature/setup/setup/serviceBusTemplate.parameters.json",
          "contentVersion":"1.0.0.0"
       },
       "parameters":{
         "serviceBusNamespaceName": {"value": "[variables('serviceBusNamespaceName')]"}
       }
      } 
    },
    {
      "apiVersion": "2015-01-01", 
      "name": "docDbTemplate", 
      "type": "Microsoft.Resources/deployments", 
      "properties": { 
        "mode": "incremental", 
        "templateLink": {
          "uri": "https://raw.githubusercontent.com/vermegi/demo-azure-eventing/feature/setup/setup/docDbTemplate.json",
          "contentVersion": "1.0.0.0"
        }, 
        "parametersLink": { 
          "uri":"https://raw.githubusercontent.com/vermegi/demo-azure-eventing/feature/setup/setup/docDbTemplate.parameters.json",
          "contentVersion":"1.0.0.0"
       },
       "parameters":{
         "databaseAccountName": {"value": "[variables('databaseAccountName')]"}
       }
      } 
    }
    // {
    //   "apiVersion": "2015-01-01", 
    //   "name": "logicAppTemplate", 
    //   "type": "Microsoft.Resources/deployments", 
    //   "properties": { 
    //     "mode": "incremental", 
    //     "templateLink": {
    //       "uri": "https://raw.githubusercontent.com/vermegi/demo-azure-eventing/feature/setup/setup/logicAppTemplate.json",
    //       "contentVersion": "1.0.0.0"
    //     }, 
    //     "parametersLink": { 
    //       "uri":"https://raw.githubusercontent.com/vermegi/demo-azure-eventing/feature/setup/setup/logicAppTemplate.parameters.json",
    //       "contentVersion":"1.0.0.0"
    //    },
    //    "parameters":{
    //      "logicAppName": { "value": "[variables('logicAppName')]" },
    //      "sb_connectionString": {"value": "[reference('serviceBusTemplate').outputs.NamespaceDefaultConnectionString]"},
    //      "docdb_databaseAccount": {"value": "[reference('docDbTemplate').outputs.docDbEndpoint]"},
    //      "docdb_accessKey": {"value": "[reference('docDbTemplate').outputs.docDbPrimaryKey]"}
    //    },
    //     "dependsOn": [
    //       "[resourceId('Microsoft.ServiceBus/namespaces', variables('serviceBusNamespaceName'))]",
    //       "[resourceId('Microsoft.DocumentDB/databaseAccounts', variables('databaseAccountName'))]"
    //     ]
    //   } 
    // }
  ],
  "outputs": {
        "NamespaceDefaultConnectionString": {
            "type": "string",
            "value": "[reference('serviceBusTemplate').outputs.NamespaceDefaultConnectionString]"
        },
        "DefaultSharedAccessPolicyPrimaryKey": {
            "type": "string",
            "value": "[reference('serviceBusTemplate').outputs.DefaultSharedAccessPolicyPrimaryKey]"
        },
        "docDbEndpoint": {
          "type": "string",
          "value": "[reference('docDbTemplate').outputs.docDbEndpoint]"
        },
        "docDbPrimaryKey":{
          "type": "string",
          "value": "[reference('docDbTemplate').outputs.docDbPrimaryKey]"
        }
    }
}